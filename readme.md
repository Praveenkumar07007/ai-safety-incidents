# AI Safety Incident Log API

This project implements a simple RESTful API service for logging and managing hypothetical AI safety incidents, as part of the HumanChain Backend Intern Take-Home Assignment. The API allows creating, retrieving, updating, and deleting incident records stored in a MongoDB database.

## Technology Stack

*   **Language:** Javascript
*   **Framework:** Express.js
*   **Database:** MongoDB
*   **ODM:** Mongoose

## Prerequisites

*   Node.js (version > 18.0.0)
*   npm
*   MongoDB Server

## Setup and Installation

1.  **Clone the Repository:**
    ```
    git clone https://github.com/Praveenkumar07007/ai-safety-incidents.git
    cd ai-safety-incidents
    ```

2.  **Install Dependencies:**
    ```
    npm install
    ```

3.  **Configure Environment Variables:**
    Create a `.env` file in the root directory of the project.
    Add the these environment variables:
    ```
    # .env
    MONGODB_URI=mongodb://localhost:27017/incidentLogDB
    PORT=3000
    ```

4.  **Database Schema:**
    The database schema is defined using Mongoose in `src/models/incidentModel.js`. Mongoose will automatically create the `incidents` collection in the specified database (`incidentLogDB`) when the application first attempts to interact with it.

    Each incident document has the following structure:
    *   `_id`: Unique identifier automatically generated by MongoDB (ObjectId). Accessible as `id` in JSON responses via Mongoose virtuals if enabled (currently uses `_id`).
    *   `title`: String (Required)
    *   `description`: String (Required)
    *   `severity`: String (Required, must be one of: "Low", "Medium", "High")
    *   `reported_at`: Date (Defaults to the time of creation)

5.  **Some sample of data for testing of Api :**
    ```
      {
        {
            "_id": {
            "$oid": "680bbc509fe3c915399cd268"
        }   ,
        "title": "Incident 2: Bias Alert",
        "description": "Security incident #2 detected in Data Storage. Requires High priority attention.",
        "severity": "High"
        },
        {
            "_id": {
            "$oid": "680bbc509fe3c915399cd26a"
        },
        "title": "Incident 4: Access Issue",
        "description": "Security incident #4 detected in Model API. Requires Medium priority attention.",
        "severity": "Medium"
        }
    }
    ```

## Running the Application

1.  **Development Mode (with auto-reload using nodemon):**
    ```
    npm run dev
    ```
    The server will start, typically on `http://localhost:3000`.

2.  **Production Mode:**
    ```
    npm start
    ```

## API Endpoints

All endpoints operate under the base path `/incidents`. Request and response bodies are in JSON format.

### 1. GET /incidents

*   **Action:** Retrieve all incidents currently stored in the database.
*   **Success Response:** `200 OK` with a JSON array of incident objects.
    ```
    [
      { "_id": "...", "title": "...", "description": "...", "severity": "...", "reported_at": "..." },
      { "_id": "...", "title": "...", "description": "...", "severity": "...", "reported_at": "..." }
    ]
    ```
*   **`curl` Example:**
    ```
    curl http://localhost:3000/incidents
    ```

### 2. POST /incidents

*   **Action:** Log a new incident. The database assigns `_id`, and `reported_at` is set automatically .
*   **Request Body:** JSON object with `title`, `description`, and `severity`.
    ```
    {
      "title": "New Incident Title",
      "description": "Detailed description here.",
      "severity": "Medium"
    }
    ```
*   **Success Response:** `201 Created` with the JSON object of the newly created incident .
    ```
    {
      "_id": "...",
      "title": "New Incident Title",
      "description": "Detailed description here.",
      "severity": "Medium",
      "reported_at": "..."
    }
    ```
*   **Error Response:** `400 Bad Request` if required fields are missing or `severity` is invalid .
*   **`curl` Example:**
    ```
    curl -X POST -H "Content-Type: application/json" \
         -d '{ "title": "Unauthorized Access Attempt", "description": "Detected multiple failed login attempts from an unknown IP.", "severity": "Low" }' \
         http://localhost:3000/incidents
    ```

### 3. GET /incidents/{id}

*   **Action:** Retrieve a specific incident by its unique `_id`.
*   **Path Parameter:** `{id}` - The `_id` of the incident to retrieve.
*   **Success Response:** `200 OK` with the JSON object of the requested incident.
    ```
    { "_id": "...", "title": "...", "description": "...", "severity": "...", "reported_at": "..." }
    ```
*   **Error Response:** `404 Not Found` if no incident with the given `_id` exists. `400 Bad Request` if the ID format is invalid .
*   **`curl` Example (replace `{id}` with an actual ID):**
    ```
    curl http://localhost:3000/incidents/{id}
    ```

### 4. PUT /incidents/{id}

*   **Action:** Update an existing incident by its unique `_id`.
*   **Path Parameter:** `{id}` - The `_id` of the incident to update.
*   **Request Body:** JSON object containing the fields to update (`title`, `description`, `severity`). At least one field must be provided.
    ```
    {
      "description": "Updated description with more details.",
      "severity": "High"
    }
    ```
*   **Success Response:** `200 OK` with the JSON object of the *updated* incident.
    ```
    {
      "_id": "...",
      "title": "Original Title", // (or updated if provided)
      "description": "Updated description with more details.",
      "severity": "High",
      "reported_at": "..."
    }
    ```
*   **Error Response:** `404 Not Found` if no incident with the given `_id` exists. `400 Bad Request` if the ID format is invalid, no update data is provided, or validation fails (e.g., invalid `severity`).
*   **`curl` Example (replace `{id}` with an actual ID):**
    ```
    curl -X PUT -H "Content-Type: application/json" \
         -d '{ "severity": "High", "description": "Severity reassessed based on impact analysis." }' \
         http://localhost:3000/incidents/{id}
    ```

### 5. DELETE /incidents/{id}

*   **Action:** Delete the incident with the specified `_id` .
*   **Path Parameter:** `{id}` - The `_id` of the incident to delete.
*   **Success Response:** `200 OK` with a confirmation message, or `204 No Content`.
    ```
    { "message": "Incident deleted successfully" }
    ```
*   **Error Response:** `404 Not Found` if no incident with the given `_id` exists. `400 Bad Request` if the ID format is invalid.
*   **`curl` Example (replace `{id}` with an actual ID):**
    ```
    curl -X DELETE http://localhost:3000/incidents/{id}
    ```


##
Design Decisions
*   **Structure:** The project follows a common MVC-like structure (Models, Routes, Controllers) for better organization and separation of concerns [4]. Database configuration is isolated .
*   **Update Method:** `PUT` is used for updates. While `PATCH` is sometimes preferred for partial updates, `PUT` is implemented here to update fields present in the request body, leveraging Mongoose's flexibility. `findByIdAndUpdate` with `{new: true}` ensures the updated document is returned.
